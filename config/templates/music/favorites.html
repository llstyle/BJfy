{% extends 'base.html' %}

{% block title %}Любимые треки - Music Streaming{% endblock %}

{% block content %}
<h1 class="section-header">Любимые треки</h1>

<section class="section">
    <ul class="song-list">
        {% for song in songs %}
        <li class="song-item" onclick="playSong('{{ song.audio_file.url }}', '{{ song.title }}', '{{ song.artist.name }}',  '{% if song.album.cover %}{{ song.album.cover.url }}{% else %}/static/placeholder.png{% endif %}')">
            <span class="song-number">{{ forloop.counter }}</span>
            <img src="{% if song.album.cover %}{{ song.album.cover.url }}{% else %}/static/placeholder.png{% endif %}" 
                 alt="{{ song.title }}" 
                 style="width: 48px; height: 48px; border-radius: 4px; object-fit: cover;">
            <div class="song-info">
                <div class="song-title">{{ song.title }}</div>
                <div class="song-artist">{{ song.artist.name }}</div>
            </div>
            <button class="icon-btn mdi mdi-heart-outline" onclick="event.stopPropagation(); toggleFavorite('{{ song.pk }}')" style="color: #1db954;">❤️</button>
        </li>
        {% empty %}
        <p style="color: #b3b3b3;">У вас пока нет любимых треков. Добавьте их, нажав на ❤️</p>
        {% endfor %}
    </ul>
</section>

<script>
function toggleFavorite(songId) {
    fetch(`/song/${songId}/favorite/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'removed') {
            location.reload();
        }
    });
}
</script>
{% endblock %}